# 파일명: virus_camp_simulator.py
import streamlit as st
import networkx as nx
import matplotlib.pyplot as plt
import pandas as pd

# ----------------------------
# 1. 제목
# ----------------------------
st.title("🦠 개인 맞춤 감염 위험 & 예방 시뮬레이터")

# ----------------------------
# 2. 사용자 정보 입력
# ----------------------------
st.header("1️⃣ 사용자 정보 입력")
age = st.number_input("나이", min_value=5, max_value=100, value=18)
mask = st.selectbox("마스크 착용 습관", ["항상 착용", "가끔 착용", "거의 안함"])
handwash = st.slider("손 씻기 횟수 (1일)", 0, 10, 3)
exercise = st.slider("운동 시간 (분/일)", 0, 120, 30)
sleep = st.slider("수면 시간 (시간/일)", 0, 12, 7)
outdoor = st.slider("하루 외출 횟수", 0, 10, 3)

# ----------------------------
# 3. 접촉 네트워크 입력
# ----------------------------
st.header("2️⃣ 가족/친구/학교 관계 입력")
contacts = st.number_input("직접 접촉하는 사람 수", min_value=0, max_value=50, value=5)

# ----------------------------
# 4. 감염 위험 점수 계산 (간단 가중치)
# ----------------------------
st.header("3️⃣ 개인 위험 점수 계산")
risk_score = 50  # 기본 위험 점수

# 마스크 영향
mask_dict = {"항상 착용": -15, "가끔 착용": 0, "거의 안함": 15}
risk_score += mask_dict[mask]

# 손 씻기
risk_score -= handwash * 2

# 운동
if exercise >= 30:
    risk_score -= 5
else:
    risk_score += 5

# 수면
if sleep >= 7:
    risk_score -= 5
else:
    risk_score += 5

# 외출
risk_score += outdoor * 2

# 접촉
risk_score += contacts * 3

risk_score = max(0, min(risk_score, 100))  # 0~100 제한
st.subheader(f"💡 예상 감염 위험 점수: {risk_score}/100")

# ----------------------------
# 5. 생활습관 체크리스트
# ----------------------------
st.header("4️⃣ 생활습관 체크리스트")
checklist = {
    "손 씻기 5회 이상": handwash >= 5,
    "마스크 착용": mask == "항상 착용",
    "운동 30분 이상": exercise >= 30,
    "수면 7시간 이상": sleep >= 7,
    "외출 최소화": outdoor <= 3
}
for action, status in checklist.items():
    st.write(f"{action}: {'✅' if status else '❌'}")

# ----------------------------
# 6. 간단 전파 네트워크 시뮬레이션
# ----------------------------
st.header("5️⃣ 전파 네트워크 시뮬레이션")
G = nx.erdos_renyi_graph(contacts + 1, 0.3)
pos = nx.spring_layout(G)

plt.figure(figsize=(5,4))
nx.draw(G, pos, with_labels=True, node_color='skyblue', node_size=800, edge_color='gray')
st.pyplot(plt)

st.write("💡 네트워크 노드 수 = 접촉 인원 + 나")

# ----------------------------
# 7. 감염 신고 기능
# ----------------------------
st.header("6️⃣ 감염 신고")
infected = st.checkbox("현재 증상 있음 (감염 신고)")
if infected:
    st.warning("⚠️ 신고 완료! 주변 위험도 업데이트")
    risk_score += 10
    risk_score = min(risk_score, 100)
    st.subheader(f"🔺 감염 신고 후 예상 감염 위험 점수: {risk_score}/100")

# ----------------------------
# 8. 맞춤 행동 추천
# ----------------------------
st.header("7️⃣ 맞춤 행동 추천")
recommendations = []
if handwash < 5:
    recommendations.append("손 씻기 횟수 늘리기")
if mask != "항상 착용":
    recommendations.append("마스크 항상 착용")
if exercise < 30:
    recommendations.append("운동 30분 이상")
if sleep < 7:
    recommendations.append("수면 충분히 취하기")
if outdoor > 3:
    recommendations.append("외출 최소화")
if infected:
    recommendations.append("다른 사람 접촉 최소화")

st.write("💡 추천 행동:")
for r in recommendations:
    st.write(f"- {r}")

