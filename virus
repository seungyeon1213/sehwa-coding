# íŒŒì¼ëª…: virus_camp_simulator.py
import streamlit as st
import networkx as nx
import matplotlib.pyplot as plt
import pandas as pd

# ----------------------------
# 1. ì œëª©
# ----------------------------
st.title("ğŸ¦  ê°œì¸ ë§ì¶¤ ê°ì—¼ ìœ„í—˜ & ì˜ˆë°© ì‹œë®¬ë ˆì´í„°")

# ----------------------------
# 2. ì‚¬ìš©ì ì •ë³´ ì…ë ¥
# ----------------------------
st.header("1ï¸âƒ£ ì‚¬ìš©ì ì •ë³´ ì…ë ¥")
age = st.number_input("ë‚˜ì´", min_value=5, max_value=100, value=18)
mask = st.selectbox("ë§ˆìŠ¤í¬ ì°©ìš© ìŠµê´€", ["í•­ìƒ ì°©ìš©", "ê°€ë” ì°©ìš©", "ê±°ì˜ ì•ˆí•¨"])
handwash = st.slider("ì† ì”»ê¸° íšŸìˆ˜ (1ì¼)", 0, 10, 3)
exercise = st.slider("ìš´ë™ ì‹œê°„ (ë¶„/ì¼)", 0, 120, 30)
sleep = st.slider("ìˆ˜ë©´ ì‹œê°„ (ì‹œê°„/ì¼)", 0, 12, 7)
outdoor = st.slider("í•˜ë£¨ ì™¸ì¶œ íšŸìˆ˜", 0, 10, 3)

# ----------------------------
# 3. ì ‘ì´‰ ë„¤íŠ¸ì›Œí¬ ì…ë ¥
# ----------------------------
st.header("2ï¸âƒ£ ê°€ì¡±/ì¹œêµ¬/í•™êµ ê´€ê³„ ì…ë ¥")
contacts = st.number_input("ì§ì ‘ ì ‘ì´‰í•˜ëŠ” ì‚¬ëŒ ìˆ˜", min_value=0, max_value=50, value=5)

# ----------------------------
# 4. ê°ì—¼ ìœ„í—˜ ì ìˆ˜ ê³„ì‚° (ê°„ë‹¨ ê°€ì¤‘ì¹˜)
# ----------------------------
st.header("3ï¸âƒ£ ê°œì¸ ìœ„í—˜ ì ìˆ˜ ê³„ì‚°")
risk_score = 50  # ê¸°ë³¸ ìœ„í—˜ ì ìˆ˜

# ë§ˆìŠ¤í¬ ì˜í–¥
mask_dict = {"í•­ìƒ ì°©ìš©": -15, "ê°€ë” ì°©ìš©": 0, "ê±°ì˜ ì•ˆí•¨": 15}
risk_score += mask_dict[mask]

# ì† ì”»ê¸°
risk_score -= handwash * 2

# ìš´ë™
if exercise >= 30:
    risk_score -= 5
else:
    risk_score += 5

# ìˆ˜ë©´
if sleep >= 7:
    risk_score -= 5
else:
    risk_score += 5

# ì™¸ì¶œ
risk_score += outdoor * 2

# ì ‘ì´‰
risk_score += contacts * 3

risk_score = max(0, min(risk_score, 100))  # 0~100 ì œí•œ
st.subheader(f"ğŸ’¡ ì˜ˆìƒ ê°ì—¼ ìœ„í—˜ ì ìˆ˜: {risk_score}/100")

# ----------------------------
# 5. ìƒí™œìŠµê´€ ì²´í¬ë¦¬ìŠ¤íŠ¸
# ----------------------------
st.header("4ï¸âƒ£ ìƒí™œìŠµê´€ ì²´í¬ë¦¬ìŠ¤íŠ¸")
checklist = {
    "ì† ì”»ê¸° 5íšŒ ì´ìƒ": handwash >= 5,
    "ë§ˆìŠ¤í¬ ì°©ìš©": mask == "í•­ìƒ ì°©ìš©",
    "ìš´ë™ 30ë¶„ ì´ìƒ": exercise >= 30,
    "ìˆ˜ë©´ 7ì‹œê°„ ì´ìƒ": sleep >= 7,
    "ì™¸ì¶œ ìµœì†Œí™”": outdoor <= 3
}
for action, status in checklist.items():
    st.write(f"{action}: {'âœ…' if status else 'âŒ'}")

# ----------------------------
# 6. ê°„ë‹¨ ì „íŒŒ ë„¤íŠ¸ì›Œí¬ ì‹œë®¬ë ˆì´ì…˜
# ----------------------------
st.header("5ï¸âƒ£ ì „íŒŒ ë„¤íŠ¸ì›Œí¬ ì‹œë®¬ë ˆì´ì…˜")
G = nx.erdos_renyi_graph(contacts + 1, 0.3)
pos = nx.spring_layout(G)

plt.figure(figsize=(5,4))
nx.draw(G, pos, with_labels=True, node_color='skyblue', node_size=800, edge_color='gray')
st.pyplot(plt)

st.write("ğŸ’¡ ë„¤íŠ¸ì›Œí¬ ë…¸ë“œ ìˆ˜ = ì ‘ì´‰ ì¸ì› + ë‚˜")

# ----------------------------
# 7. ê°ì—¼ ì‹ ê³  ê¸°ëŠ¥
# ----------------------------
st.header("6ï¸âƒ£ ê°ì—¼ ì‹ ê³ ")
infected = st.checkbox("í˜„ì¬ ì¦ìƒ ìˆìŒ (ê°ì—¼ ì‹ ê³ )")
if infected:
    st.warning("âš ï¸ ì‹ ê³  ì™„ë£Œ! ì£¼ë³€ ìœ„í—˜ë„ ì—…ë°ì´íŠ¸")
    risk_score += 10
    risk_score = min(risk_score, 100)
    st.subheader(f"ğŸ”º ê°ì—¼ ì‹ ê³  í›„ ì˜ˆìƒ ê°ì—¼ ìœ„í—˜ ì ìˆ˜: {risk_score}/100")

# ----------------------------
# 8. ë§ì¶¤ í–‰ë™ ì¶”ì²œ
# ----------------------------
st.header("7ï¸âƒ£ ë§ì¶¤ í–‰ë™ ì¶”ì²œ")
recommendations = []
if handwash < 5:
    recommendations.append("ì† ì”»ê¸° íšŸìˆ˜ ëŠ˜ë¦¬ê¸°")
if mask != "í•­ìƒ ì°©ìš©":
    recommendations.append("ë§ˆìŠ¤í¬ í•­ìƒ ì°©ìš©")
if exercise < 30:
    recommendations.append("ìš´ë™ 30ë¶„ ì´ìƒ")
if sleep < 7:
    recommendations.append("ìˆ˜ë©´ ì¶©ë¶„íˆ ì·¨í•˜ê¸°")
if outdoor > 3:
    recommendations.append("ì™¸ì¶œ ìµœì†Œí™”")
if infected:
    recommendations.append("ë‹¤ë¥¸ ì‚¬ëŒ ì ‘ì´‰ ìµœì†Œí™”")

st.write("ğŸ’¡ ì¶”ì²œ í–‰ë™:")
for r in recommendations:
    st.write(f"- {r}")

