import streamlit as st
import random

# âœ… MBTI í™˜ìŠ¹ / ì¬íšŒ ì¶”ì²œ ë°ì´í„°ì…‹
MBTI_MAP = {
    'ISTJ': {
        'í™˜ìŠ¹': [('ESFP', 0.35), ('ENFP', 0.25), ('ISFJ', 0.15), ('ENTJ', 0.10), ('INFP', 0.15)],
        'ì¬íšŒ': [('ISFJ', 0.35), ('ISTP', 0.25), ('ESFJ', 0.20), ('ESTJ', 0.20)]
    },
    'ISFJ': {
        'í™˜ìŠ¹': [('ENFP', 0.30), ('ESFP', 0.25), ('ISFP', 0.20), ('ISTJ', 0.25)],
        'ì¬íšŒ': [('ISTJ', 0.35), ('ISFP', 0.25), ('ESFJ', 0.20), ('INFJ', 0.20)]
    },
    'INFJ': {
        'í™˜ìŠ¹': [('ENTP', 0.30), ('ENFP', 0.30), ('INTP', 0.20), ('ISFJ', 0.20)],
        'ì¬íšŒ': [('ENFP', 0.35), ('INFJ', 0.25), ('ENFJ', 0.20), ('INTJ', 0.20)]
    },
    'INTJ': {
        'í™˜ìŠ¹': [('ENFP', 0.35), ('ENTP', 0.25), ('INTP', 0.20), ('ESTJ', 0.20)],
        'ì¬íšŒ': [('INTP', 0.30), ('ENTJ', 0.30), ('INFJ', 0.20), ('ISTJ', 0.20)]
    },
    'ISTP': {
        'í™˜ìŠ¹': [('ESFJ', 0.30), ('ESTP', 0.25), ('ISFP', 0.25), ('ENTP', 0.20)],
        'ì¬íšŒ': [('ISFP', 0.30), ('ISTP', 0.25), ('ESTP', 0.20), ('ISTJ', 0.25)]
    },
    'ISFP': {
        'í™˜ìŠ¹': [('ESTJ', 0.30), ('ESFJ', 0.25), ('INFP', 0.25), ('ESFP', 0.20)],
        'ì¬íšŒ': [('ISFP', 0.30), ('ISFJ', 0.25), ('INFP', 0.25), ('ESFP', 0.20)]
    },
    'INFP': {
        'í™˜ìŠ¹': [('ENFJ', 0.30), ('ENFP', 0.30), ('INFJ', 0.20), ('ISFP', 0.20)],
        'ì¬íšŒ': [('INFJ', 0.35), ('ENFP', 0.25), ('INFP', 0.20), ('ISFP', 0.20)]
    },
    'INTP': {
        'í™˜ìŠ¹': [('ENTJ', 0.30), ('ENFP', 0.25), ('INTJ', 0.25), ('INFP', 0.20)],
        'ì¬íšŒ': [('INTJ', 0.30), ('ENTP', 0.25), ('INTP', 0.25), ('INFP', 0.20)]
    },
    'ESTP': {
        'í™˜ìŠ¹': [('ISFJ', 0.30), ('ISTJ', 0.25), ('ESFP', 0.25), ('ENFP', 0.20)],
        'ì¬íšŒ': [('ESFP', 0.35), ('ESTP', 0.25), ('ISFP', 0.20), ('ISTP', 0.20)]
    },
    'ESFP': {
        'í™˜ìŠ¹': [('ISTJ', 0.30), ('ISFJ', 0.25), ('ENFJ', 0.25), ('ESFP', 0.20)],
        'ì¬íšŒ': [('ESTP', 0.35), ('ISFP', 0.25), ('ESFJ', 0.20), ('ENFP', 0.20)]
    },
    'ENFP': {
        'í™˜ìŠ¹': [('ISTJ', 0.30), ('INTJ', 0.25), ('ENFJ', 0.25), ('INFP', 0.20)],
        'ì¬íšŒ': [('INFP', 0.35), ('ENFP', 0.25), ('INFJ', 0.20), ('ENTP', 0.20)]
    },
    'ENTP': {
        'í™˜ìŠ¹': [('INFJ', 0.30), ('INTJ', 0.25), ('ENTJ', 0.25), ('ENFP', 0.20)],
        'ì¬íšŒ': [('ENTJ', 0.30), ('ENFP', 0.25), ('ENTP', 0.25), ('INTP', 0.20)]
    },
    'ESTJ': {
        'í™˜ìŠ¹': [('ISFP', 0.30), ('ISTP', 0.25), ('ESFJ', 0.25), ('ENFP', 0.20)],
        'ì¬íšŒ': [('ISTJ', 0.35), ('ESTJ', 0.25), ('ESFJ', 0.20), ('ENTJ', 0.20)]
    },
    'ESFJ': {
        'í™˜ìŠ¹': [('INTP', 0.30), ('ISTP', 0.25), ('ENFP', 0.25), ('ISFJ', 0.20)],
        'ì¬íšŒ': [('ISFJ', 0.35), ('ESFJ', 0.25), ('ENFJ', 0.20), ('ESTJ', 0.20)]
    },
    'ENFJ': {
        'í™˜ìŠ¹': [('ISFP', 0.30), ('INFP', 0.30), ('ENTP', 0.20), ('ESFJ', 0.20)],
        'ì¬íšŒ': [('ENFP', 0.35), ('ENFJ', 0.25), ('INFJ', 0.20), ('ESFJ', 0.20)]
    },
    'ENTJ': {
        'í™˜ìŠ¹': [('ISFP', 0.30), ('INFP', 0.25), ('INTP', 0.25), ('ENFP', 0.20)],
        'ì¬íšŒ': [('ENTP', 0.30), ('INTJ', 0.25), ('ENTJ', 0.25), ('ESTJ', 0.20)]
    }
}


transfer_lines = [
    "ğŸ’¥ ê·¸ ì‚¬ëŒ? ë„ˆ ì—†ì´ë„ ì˜ ì‚¬ëŠ” ì²™ í•˜ì§€ë§Œâ€¦ ì‚¬ì‹¤ ë„ˆë¬´ ê¶ê¸ˆí•´í•¨.",
    "ğŸ¯ ìƒˆë¡œìš´ ì„¤ë ˜ì´ ì°¾ì•„ì˜¤ê³  ë§ì•˜ë‹¤â€¦ ë¹ ì ¸ë“ ë‹¤â€¦",
    "ğŸ”¥ ì „ ì• ì¸ì€ ì´ë¯¸ ì¶”ì–µ ì† ìºë¦­í„°!",
    "ğŸŒªï¸ ë„ˆì˜ ë§¤ë ¥ì— íœ˜ë§ë¦° ì‚¬ëŒ ë“±ì¥!"
]

reunion_lines = [
    "ğŸ’˜ ì„œë¡œì˜ ë¹ˆìë¦¬ê°€ ë„ˆë¬´ í¬ê²Œ ëŠê»´ì¡Œë‹¤â€¦",
    "ğŸ“ ìš°ì—°íˆ ì˜¨ ì—°ë½ í•œ í†µâ€¦ ë‹¤ì‹œ ì‹œì‘ë˜ëŠ” ê°ì •ì„ !",
    "ğŸ§² í‹°ê²©íƒœê²©í–ˆëŠ”ë°â€¦ ê²°êµ­ì€ ì„œë¡œì˜€ë‹¤!",
    "ğŸŒ™ ê·¸ ì‚¬ëŒë„ ì‚¬ì‹¤ ê³„ì† ìƒê°í•˜ê³  ìˆì—ˆìŒ."
]

advice_lines = [
    "âœ¨ ìì‹ ê° ì¥ì°©í•˜ê³  ë‚˜ê°€ë¼!",
    "ğŸ˜ ë°€ë‹¹ ê¸ˆì§€! ì†”ì§í•¨ì´ ìµœê³ ì˜ ë¬´ê¸°.",
    "ğŸ§Š ì¿¨í•œ ì²™? í•˜ì§€ë§ˆ! ë§ˆìŒì„ ë“œëŸ¬ë‚´!",
    "ğŸ€ ì´ë²ˆì—” ë„ˆê°€ í–‰ë³µí•´ì§€ëŠ” ë°©í–¥ìœ¼ë¡œ ê°€ì."
]

def weighted_choice(choices):
    total = sum(w for _, w in choices)
    r = random.random() * total
    upto = 0
    for c, w in choices:
        if upto + w >= r:
            return c, w
        upto += w
    return choices[-1]

st.title("ğŸ’” í™˜ìŠ¹ì—°ì•  MBTI ìš´ëª… íŒë…ê¸° ğŸ¬")
st.caption("â€» ì‹¤ì¡´ ì¸ë¬¼ê³¼ ë‹®ì•˜ë‹¤ë©´â€¦ê·¸ê±´ ìš´ëª…ì…ë‹ˆë‹¤ ğŸ˜Œ")

mbti_input = st.text_input("MBTI ì…ë ¥ (ì˜ˆ: ENFP)").upper()

if st.button("ìš´ëª… ê³µê°œ!"):

    if mbti_input not in MBTI_MAP:
        st.error("ğŸ˜¡ MBTI ë§ê²Œ ì“°ë¼ê³ ! (ì˜ˆ: ISTP, ENTP)")
    else:
        transfer, w_t = weighted_choice(MBTI_MAP[mbti_input]['í™˜ìŠ¹'])
        reunion, w_r = weighted_choice(MBTI_MAP[mbti_input]['ì¬íšŒ'])

        st.subheader(f"ğŸ‘€ {mbti_input}ì˜ ì—°ì•  ìš´ëª… ì‹œë‚˜ë¦¬ì˜¤")

        mode = random.choice(["í™˜ìŠ¹", "ì¬íšŒ"])
        
        if mode == "í™˜ìŠ¹":
            st.info("ğŸš€ **í™˜ìŠ¹ ì—”ë”© ì˜ˆì¸¡**")
            st.write(f"ğŸ‘‰ ìƒëŒ€ MBTI: **{transfer}**")
            st.write(f"ğŸ“ˆ ì‹ ë¢°ë„: **{round(w_t*100)}%**")
            st.write("ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤:")
            st.write(random.choice(transfer_lines))
        else:
            st.success("ğŸ’ **ì¬íšŒ ì—”ë”© ì˜ˆì¸¡**")
            st.write(f"ğŸ‘‰ ìƒëŒ€ MBTI: **{reunion}**")
            st.write(f"ğŸ“ˆ ì‹ ë¢°ë„: **{round(w_r*100)}%**")
            st.write("ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤:")
            st.write(random.choice(reunion_lines))

        st.write("---")
        st.write("ğŸ“Œ ì˜¤ëŠ˜ì˜ ì—°ì•  ì¡°ì–¸:")
        st.write(random.choice(advice_lines))

        st.caption("â€» *ë‹¹ì‹ ì˜ ì „ë‚¨ì¹œ/ì „ì—¬ì¹œì´ ì´ê±¸ ë³´ê³  ìˆë‹¤ë©´ ê¸´ì¥í•´ë¼.* ğŸ¤«")
